<html>
<head>
    <meta charset="utf-8"/>
<meta name="description" content=""/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<title>SpringBoot Jpa 的使用 | 高士傑</title>

<link rel="shortcut icon" href="https://1958818905.github.io/favicon.ico?v=1600085048534">

<link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://1958818905.github.io/styles/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css">

<script src="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets/highlight.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.15.10/languages/dockerfile.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.15.10/languages/dart.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/moment@2.27.0/moment.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.min.js"></script>
<!-- DEMO JS -->
<!--<script src="media/scripts/index.js"></script>-->



    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.css">
</head>
<body>
<div class="main gt-bg-theme-color-first">
    <nav class="navbar navbar-expand-lg">
    <div class="navbar-brand">
        <img class="user-avatar" src="/images/avatar.png" alt="头像">
        <div class="site-name gt-c-content-color-first">
            高士傑
        </div>
    </div>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <i class="fas fa-bars gt-c-content-color-first" style="font-size: 18px"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <div class="navbar-nav mr-auto" style="text-align: center">
            
                <div class="nav-item">
                    
                        <a href="/" class="menu gt-a-link">
                            首页
                        </a>
                    
                </div>
            
                <div class="nav-item">
                    
                        <a href="/archives" class="menu gt-a-link">
                            归档
                        </a>
                    
                </div>
            
                <div class="nav-item">
                    
                        <a href="/tags" class="menu gt-a-link">
                            标签
                        </a>
                    
                </div>
            
                <div class="nav-item">
                    
                        <a href="/post/about" class="menu gt-a-link">
                            关于
                        </a>
                    
                </div>
            
        </div>
        <div style="text-align: center">
            <form id="gridea-search-form" style="position: relative" data-update="1600085048534" action="/search/index.html">
                <input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="搜索文章" />
                <i class="fas fa-search gt-c-content-color-first" style="position: absolute; top: 9px; left: 10px;"></i>
            </form>
        </div>
    </div>
</nav>

    <div class="post-container">
        <div class="post-detail gt-bg-theme-color-second">
            <article class="gt-post-content">
                <h2 class="post-title">
                    SpringBoot Jpa 的使用
                </h2>
                <div class="post-info">
                    <time class="post-time gt-c-content-color-first">
                        · 2020-09-09 ·
                    </time>
                    
                </div>
                <div class="post-content">
                    <h3 id="spring-boot-jpa-介绍">Spring Boot Jpa 介绍</h3>
<ol>
<li>Jpa 是什么？</li>
</ol>
<ul>
<li>Jpa (Java Persistence API) 是 Sun 官方提出的 Java 持久化规范。它为 Java 开发人员提供了一种对象/关联映射工具来管理 Java 应用中的关系数据。它的出现主要是为了简化现有的持久化开发工作和整合 ORM 技术，结束现在 Hibernate，TopLink，JDO 等 ORM 框架各自为营的局面。<br>
值得注意的是，Jpa是在充分吸收了现有 Hibernate，TopLink，JDO 等 ORM 框架的基础上发展而来的，具有易于使用，伸缩性强等优点。从目前的开发社区的反应上看，Jpa 受到了极大的支持和赞扬，其中就包括了 Spring 与 EJB3. 0的开发团队。</li>
<li>注意：Jpa 是一套规范，不是一套产品，那么像 Hibernate,TopLink,JDO 他们是一套产品，如果说这些产品实现了这个 Jpa 规范，那么我们就可以叫他们为 Jpa 的实现产品。</li>
</ul>
<ol start="2">
<li>Spring Boot Jpa</li>
</ol>
<ul>
<li>Spring Boot Jpa 是 Spring 基于 ORM 框架、Jpa 规范的基础上封装的一套 Jpa 应用框架，可使开发者用极简的代码即可实现对数据的访问和操作。它提供了包括增删改查等在内的常用功能，且易于扩展！学习并使用 Spring Data Jpa 可以极大提高开发效率！</li>
<li>Spring Boot Jpa 让我们解脱了 DAO 层的操作，基本上所有 CRUD 都可以依赖于它来实现。</li>
</ul>
<ol start="3">
<li>基本查询</li>
</ol>
<ul>
<li>基本查询也分为两种，一种是 Spring Data 默认已经实现，一种是根据查询的方法来自动解析成 SQL。</li>
<li>预先生成方法</li>
<li>继承 JpaRepository
<ul>
<li>Spring Boot Jpa 默认预先生成了一些基本的CURD的方法，例如：增、删、改等等</li>
</ul>
<pre><code class="language-java">public interface UserRepository extends JpaRepository&lt;User, Long&gt; {
</code></pre>
</li>
</ul>
<p>}</p>
<pre><code>- 使用默认方法
```java
@Test
public void testBaseQuery() throws Exception {
	User user=new User();
	userRepository.findAll();
	userRepository.findOne(1l);
	userRepository.save(user);
	userRepository.delete(user);
	userRepository.count();
	userRepository.exists(1l);
	// ...
}
</code></pre>
<ul>
<li>自定义简单查询
<ul>
<li>自定义的简单查询就是根据方法名来自动生成 SQL，主要的语法是findXXBy,readAXXBy,queryXXBy,countXXBy, getXXBy后面跟属性名称：</li>
</ul>
<pre><code class="language-java">User findByUserName(String userName);
</code></pre>
<ul>
<li>也使用一些加一些关键字And 、 Or</li>
</ul>
</li>
</ul>
<pre><code class="language-java">User findByUserNameOrEmail(String username, String email);
</code></pre>
<ul>
<li>修改、删除、统计也是类似语法</li>
</ul>
<pre><code class="language-java">Long deleteById(Long id);
Long countByUserName(String userName)
</code></pre>
<ul>
<li>基本上 SQL 体系中的关键词都可以使用，例如： LIKE 、 IgnoreCase、 OrderBy。</li>
</ul>
<pre><code class="language-java">List&lt;User&gt; findByEmailLike(String email);
User findByUserNameIgnoreCase(String userName);
List&lt;User&gt; findByUserNameOrderByEmailDesc(String email);
</code></pre>
<ol start="4">
<li>复杂查询</li>
</ol>
<ul>
<li>在实际的开发中我们需要用到分页、删选、连表等查询的时候就需要特殊的方法或者自定义 SQL</li>
<li>分页查询
<ul>
<li>分页查询在实际使用中非常普遍了，Spring Boot Jpa 已经帮我们实现了分页的功能，在查询的方法中，需要传入参数Pageable ,当查询中有多个参数的时候Pageable建议做为最后一个参数传入.</li>
</ul>
<pre><code class="language-java">Page&lt;User&gt; findALL(Pageable pageable);
</code></pre>
</li>
</ul>
<p>Page<User> findByUserName(String userName,Pageable pageable);</p>
<pre><code>  - Pageable 是 Spring 封装的分页实现类，使用的时候需要传入页数、每页条数和排序规则
  ```java
   @Test
public void testPageQuery() throws Exception {
	int page=1,size=10;
	Sort sort = new Sort(Direction.DESC, &quot;id&quot;);
    Pageable pageable = new PageRequest(page, size, sort);
    userRepository.findALL(pageable);
    userRepository.findByUserName(&quot;testName&quot;, pageable);
}
</code></pre>
<ol start="5">
<li>限制查询</li>
</ol>
<ul>
<li>有时候我们只需要查询前N个元素，或者支取前一个实体。</li>
</ul>
<pre><code class="language-java">User findFirstByOrderByLastnameAsc();
User findTopByOrderByAgeDesc();
Page&lt;User&gt; queryFirst10ByLastname(String lastname, Pageable pageable);
List&lt;User&gt; findFirst10ByLastname(String lastname, Sort sort);
List&lt;User&gt; findTop10ByLastname(String lastname, Pageable pageable);
</code></pre>
<ol start="6">
<li>自定义SQL查询</li>
</ol>
<ul>
<li>其实 Spring Data 觉大部分的 SQL 都可以根据方法名定义的方式来实现，但是由于某些原因我们想使用自定义的 SQL 来查询，Spring Data 也是完美支持的；在 SQL 的查询方法上面使用@Query注解，如涉及到删除和修改在需要加上@Modifying.也可以根据需要添加 @Transactional对事物的支持，查询超时的设置等。</li>
</ul>
<pre><code class="language-java">@Modifying
@Query(&quot;update User u set u.userName = ?1 where u.id = ?2&quot;)
int modifyByIdAndUserId(String  userName, Long id);
	
@Transactional
@Modifying
@Query(&quot;delete from User where id = ?1&quot;)
void deleteByUserId(Long id);
  
@Transactional(timeout = 10)
@Query(&quot;select u from User u where u.emailAddress = ?1&quot;)
User findByEmailAddress(String emailAddress);
</code></pre>
<ol start="7">
<li>多表查询</li>
</ol>
<ul>
<li>多表查询 Spring Boot Jpa 中有两种实现方式，第一种是利用 Hibernate 的级联查询来实现，第二种是创建一个结果集的接口来接收连表查询后的结果，这里主要第二种方式。</li>
<li>首先需要定义一个结果集的接口类。</li>
</ul>
<pre><code class="language-java">public interface HotelSummary {

	City getCity();

	String getName();

	Double getAverageRating();

	default Integer getAverageRatingRounded() {
		return getAverageRating() == null ? null : (int) Math.round(getAverageRating());
	}

}
</code></pre>
<ul>
<li>查询的方法返回类型设置为新创建的接口</li>
</ul>
<pre><code class="language-java">
@Query(&quot;select h.city as city, h.name as name, avg(r.rating) as averageRating &quot;
		- &quot;from Hotel h left outer join h.reviews r where h.city = ?1 group by h&quot;)
Page&lt;HotelSummary&gt; findByCity(City city, Pageable pageable);

@Query(&quot;select h.name as name, avg(r.rating) as averageRating &quot;
		- &quot;from Hotel h left outer join h.reviews r  group by h&quot;)
Page&lt;HotelSummary&gt; findByCity(Pageable pageable);
</code></pre>
<ul>
<li>使用</li>
</ul>
<pre><code class="language-java">Page&lt;HotelSummary&gt; hotels = this.hotelRepository.findByCity(new PageRequest(0, 10, Direction.ASC, &quot;name&quot;));
for(HotelSummary summay:hotels){
		System.out.println(&quot;Name&quot; +summay.getName());
	}
</code></pre>

                </div>
            </article>
        </div>

        
            <div class="next-post">
                <div class="next gt-c-content-color-first">下一篇</div>
                <a href="https://1958818905.github.io/post/spring-bootspring-boot-zhong-redis-de-shi-yong/" class="post-title gt-a-link">
                    Spring Boot：Spring Boot 中 Redis 的使用
                </a>
            </div>
        

        

        

        

        <div class="site-footer gt-c-content-color-first">
    <div class="slogan gt-c-content-color-first">温故而知新</div>
    <div class="social-container">
        
            
        
            
        
            
        
            
        
            
        
            
        
    </div>
    <div class="footer-info">
        Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>
    </div>
    <div>
        Theme by <a href="https://imhanjie.com/" target="_blank">imhanjie</a>, Powered by <a
                href="https://github.com/getgridea/gridea" target="_blank">Gridea | <a href="https://1958818905.github.io/atom.xml" target="_blank">RSS</a></a>
    </div>
</div>

<script>
  hljs.initHighlightingOnLoad()
</script>

    </div>
</div>
</body>
</html>
